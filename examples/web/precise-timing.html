<!DOCTYPE html>
<html>
  <body>
    <svg>
      <rect id="element" x="0" y="0" width="100" height="100"/>
    </svg>
    <script src="../web-animations.js"></script>
    <script>
      'use strict';
      var element = document.getElementById('element');

      var timeline = [
        { time: 1000 * 0.9998, fill: 'red' },
        { time: 1000 * 0.9999, fill: 'green' },
        { time: 1000 * 2,      fill: 'blue' },
        { time: 1000 * 2.0001, fill: 'yellow' },
        { time: 1000 * 2.0002, fill: 'lime' }
      ];

      var index;
      var startTime;

      function update() {
        var currentTime = document.timeline.currentTime - startTime;
        do {
          element.animate([{ fill: timeline[index].fill }, { fill: timeline[index].fill }], {duration: 2000});
          ++index;
          console.log(currentTime);
        } while (index < timeline.length && timeline[index].time <= currentTime)

        if (index < timeline.length)
          setTimeout(update, timeline[index].time - currentTime);
      }

      window.onload = function() {
        startTime = document.timeline.currentTime;
        index = 0;
        setTimeout(update, timeline[0].time);
      }
    </script>
  </body>
</html>
